// Generated by CoffeeScript 1.6.3
(function() {
  "use strict";
  var app1;

  app1 = angular.module("myApp.controllers", []);

  app1.controller("MyCtrl1", [
    '$scope', '$http', function($scope, $http) {
      $http.get("/static/forms/form1.json").success(function(form) {
        return $scope._form = form;
      });
      $http.get("/static/forms/user.json").success(function(user) {
        return $scope.user = user;
      });
      $scope.print = function(str) {
        return console.log(str);
      };
      return $scope.update = function(fieldName, answer) {
        var user;
        user = $scope.user;
        return $.ajax({
          url: location.hostname + "/users/" + user._id,
          data: {
            _id: user._id,
            secret: user.secret,
            update: ""
          },
          type: "POST",
          success: function(data, textStatus, jqXHR) {
            return console.log("success done");
          },
          error: function(jqXHR, textStatus, errorThrown) {
            return console.log('ERROR: ' + errorThrown);
          }
        });
      };
    }
  ]);

  app1.controller("SignInController", [
    '$scope', '$http', 'User', '$location', function($scope, $http, User, $location) {
      return $scope.signIn = function(user) {
        return $http({
          method: 'POST',
          data: {
            email: user.email,
            secret: CryptoJS.SHA512(user.email + 'oneform.in' + user.password).toString()
          },
          url: window.location.protocol + "//" + window.location.host + "/auth/users"
        }).success(function(data, status, headers, config) {
          if (data.result != null) {
            console.log(User);
            User.data = data.result;
            User.authenticated = true;
            console.log(User.data);
            console.log("Auth:");
            console.log(User.authenticated);
            return $location.path("/all_forms");
          }
        }).error(function(data, status, headers, config) {
          return console.log(data);
        });
      };
    }
  ]);

  app1.controller("SignUpController", [
    '$scope', '$location', function($scope, $location) {
      $scope.userSignUp = {};
      return $scope.signUp = function(user) {
        var data, success;
        console.log($scope.signUpForm.$valid);
        if ($scope.signUpForm.$valid) {
          console.log($scope.userSignUp);
          $scope.userSignUp = angular.copy(user);
          $scope.userSignUp["secret"] = CryptoJS.SHA512($scope.userSignUp["email"] + 'oneform.in' + $scope.userSignUp["password"]).toString();
          delete $scope.userSignUp["password"];
          data = $scope.userSignUp;
          console.log(data);
          success = function(data, textStatus, jqXHR) {
            console.log("response: ");
            console.log(data);
            $location.path("/forms");
            return $location.replace();
          };
          return make_request("/users", "POST", data, success);
        } else {
          return raise_error_message("Required fields missing");
        }
      };
    }
  ]);

  app1.controller("FormController", [
    function() {
      $scope.update = function(fieldName, answer) {
        var data;
        if ($scope.fieldName.$valid && UserService.isLogged === true) {
          console.log('signed in');
          data = {
            id: UserService.data["id"],
            secret: UserService.secret
          };
          return make_request("/users/:id", POST, data, success);
        }
      };
      return $scope.post_form = function(_form_answers) {
        var data, success;
        if ($scope._form_name.$valid) {
          console.log($scope._form_answers);
          data = $scope._form_answers;
          console.log(data);
          success = function() {
            console.log("response: ");
            return console.log(data);
          };
          return make_request("/users/:id/forms", "POST", data, success);
        } else {
          return raise_error_message("Required fields missingcd r");
        }
      };
    }
  ]);

  app1.controller("FormDisplayController", [
    'User', '$scope', '$http', function(User, $scope, $http) {
      return $http({
        method: 'GET',
        url: window.location.protocol + "//" + window.location.host + "/forms"
      }).success(function(data, status, headers, config) {
        if (data.result != null) {
          console.log(data.result);
          return $scope.forms = data.result;
        }
      }).error(function(data, status, headers, config) {
        return console.log(data);
      });
    }
  ]);

}).call(this);
